<!DOCTYPE html>
<html lang="en">
<!-- https://gist.github.com/diachedelic/0d60233dab3dcae3215da8a4dfdcd434 -->

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:title" content="ArtLink - The Artworld at your fingertips" />
    <meta property="og:image" content="./img/artlink.jpg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="500" />

    <title>ArtLink - The ArtWorld at your Fingertips</title>
    <link rel="shortcut icon" type="image/png" href="./img/favicon.png" />
    <link rel="stylesheet" type="text/css" href="./main.css" />
    <link rel="stylesheet" type="text/css" href="./bg.css" />
    <link rel="stylesheet" type="text/css" href="./subscribe.css" />
</head>

<body>
    <nav>
        <a href="./index.html">Back to website</a>
    </nav>
    <section class="main" style="transform: translate(-50%, 0px); top: 50px;">
        <img src="img/artlink.jpg" width="50px" />
        <h1>Submit Gallery / Artwork for <br /> ARTLINK SELECTION </h1>

        <br />
        <div class="page">
            <form id="main-form" onsubmit="validate(event)">
                <h3 style="text-align: left;">Fastest way to have your works published in-app is by submitting them
                    here.
                    <br />
                    <span style="color:#1fc2e7">[SOON] We'll soon launch "Artist's Sandbox" and for private
                        experiments you'll be able to upload
                        artworks
                        directly in-app, with no moderation / form.</span>
                </h3>

                <hr />
                <br />

                <span class="input-element">
                    <label for="email">Email:</label><br>
                    <input type="email" id="email" name="email" placeholder="Email" required><br>
                </span>

                <span style="text-align: left; display: inline-block; width: 80%;">
                    <input type="checkbox" id="privacy" name="privacy" value="true" required>
                    <label for="privacy">I have read and agreed with the <a href="./privacy.html"
                            target="_blank">privacy agreement</a>.</label>
                </span>
                <br />

                <button type="submit" class="submit-but" style="font-size: 1.2em;" value="1">Collection
                    &gt;</button>
            </form>
        </div>
        <div class="page" style="display: none;">
            <form id="form" onsubmit="validate(event)">

                <div id="cover-pic-image" class="hex-template">
                    <img src="./img_2/hex_overlay.png" width="256" height="256">
                </div>

                <br /><br />
                <div style="color: orange">If part of an existing gallery/exhibition fill in just the name.</div>
                <br /><br />

                <span class="input-element">
                    <label for="exhibition-cover">exhibition cover (512x512):</label><br>
                    <input type="file" id="exhibition-cover" name="exhibition-cover" accept="image/png, image/jpeg"
                        onchange="loadGalleryCover(event);">
                </span>

                <span class="input-element">
                    <label for="exhibition-name">Exhibition/Artwork name*:</label><br>
                    <input type="text" id="exhibition-name" name="exhibition-name" placeholder="Name" required><br>
                </span>

                <span class="input-element">
                    <label for="exhibition-statement">Exhibition/Artwork Statement:</label><br>
                    <textarea id="exhibition-statement" name="exhibition-statement"
                        placeholder="Art + Tech equals love!" rows="4" cols="50" maxlength="512"></textarea><br>
                </span>

                <span class="input-element">
                    <label for="extra-info">Extra information/requests for us to consider:</label><br>
                    <textarea id="extra-info" name="extra-info" placeholder="Please make the frame blue!" rows="4"
                        cols="50" maxlength="512"></textarea><br>
                </span>

                <button type="submit" class="submit-but" style="font-size: 1.2em;" value="0">
                    &lt;Intro</button>
                <button type="submit" class="submit-but" style="font-size: 1.2em;" value="2">Profile
                    ></button>
            </form>
        </div>



        <div class="page" style="display: none;">
            <form id="form" onsubmit="validate(event)">
                <div id="profile-pic-image" class="hex-template">
                </div>

                <br /><br />
                <div style="color: orange">If already having a profile, upload only your name and data you want updated.
                </div>
                <br /><br />

                <span class="input-element">
                    <label for="profile-pic">Profile pic(512x512):</label><br>
                    <input type="file" id="profile-pic" name="profile-pic" accept="image/png, image/jpeg"
                        onchange="loadProfilePic(event);">
                </span>

                <span class="input-element">
                    <label for="fname">Display name:</label><br>
                    <input type="text" id="fname" name="fname" placeholder="Name" required><br>
                </span>

                <span class="input-element">
                    <label for="social-media-links">Social media links (separated by comma):</label><br>
                    <input type="text" id="social-media-links" name="social-media-links"
                        placeholder="instagram.com/artlink.app, https://artlink.app"><br>
                </span>

                <span class="input-element">
                    <label for="artist-statement" maxlength="512">Artist Statement:</label><br>
                    <textarea id="artist-statement" name="artist-statement" placeholder="Let's work together!" rows="4"
                        cols="50"></textarea><br>
                </span>

                <span class="input-element">
                    <label for="files">ARTWORKS<br />
                        <span style="color:gray">
                            <span style="color: orangered">Please name files with the artwork titles!</span> <br />
                            (Image, Video, GIF, 3D models in ZIP format):<br />
                            MAX SIZE: 25mb</span></label>
                    <br>
                    <input type="file" id="files" name="files" accept=".zip" required
                        onchange="loadZip(event)">
                </span>


                <span id="error"></span><br />
                <button type="submit" class="submit-but" style="font-size: 1.2em;" value="1">
                    &lt;Profile</button>
                <button type="submit" class="submit-but" id="submit-but" value="-1">Submit!</button>
            </form>
        </div>

        <div id="success" style="display: none;">
            <img width="250px" src="./img_2/rocket.png">
            <p>Congratulations! Your upload is succesful! <br />
                Your content is being moderated. We'll email you if something is missing. </p>
            <h2 style="text-decoration: underline; color: white;"><a href="./index.html">Back to website</a></h2>
        </div>

        <hr />
        <div class="social-media-wrapper">
            <div style="text-align: left;">Are you thinking of a more ellaborate collaboration? <a href="./contact.html"
                    target="_blank">Send
                    us a message here</a>
                <br />
                Is the form too much of a hassle? Send us the artworks here and we'll handle the upload:
            </div>
            <br />
            <div class="social-media">
                <div class="social-media-icon mail"><a href="mailto:dragos@colorfulcoding.com" target="_blank"></a>
                </div>
                <div class="social-media-icon facebook"><a href="https://www.facebook.com/ArtLinkApp2020"
                        target="_blank"></a>
                </div>
                <div class="social-media-icon instagram"><a href="https://www.instagram.com/artlink.app/"
                        target="_blank"></a>
                </div>
                <div class="social-media-icon linkedin"><a href="https://www.linkedin.com/company/artlink-app/"
                        target="_blank"></a></div>
                <div class="social-media-icon discord"><a href="https://discord.gg/XFEZaAztBT" target="_blank"></a>
                </div>
            </div>
        </div>
        </form>
    </section>
    <div class="area">
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>
</body>

<script>
    // var URL = "https://artlink-admin-app.herokuapp.com";
    var URL = "http://localhost:3000"
    var pages = document.getElementsByClassName("page");
    var currentPageIdx = 0;

    function showPage(idx) {
        pages[currentPageIdx].style.display = "none";

        currentPageIdx = idx;
        pages[currentPageIdx].style.display = "block";
    }

    function validate(evt) {
        evt.preventDefault();
        const val = document.activeElement.value;
        if (val >= 0) {
            showPage(val);
        } else {
            trySubscribe(evt);
        }

    }

    function trySubscribe(evt) {
        document.getElementById("submit-but").style.display = "none";

        let email = document.getElementById("email").value;
        let exhibitionName = document.getElementById("exhibition-name").value;
        let exhibitionStatement = document.getElementById("exhibition-statement").value;
        let artistName = document.getElementById("fname").value;
        let socialMedia = document.getElementById("social-media-links").value;
        let artistStatement = document.getElementById("artist-statement").value;
        let extraInfo = document.getElementById("extra-info").value;


        let artSubmission = {
            user: {
                email: email,
                artistName: artistName,
                artistStatement: artistStatement,
                socialMedia: socialMedia
            },
            exhibition: {
                exhibitionName: exhibitionName,
                exhibitionStatement: exhibitionStatement,
                extraInfo: extraInfo
            }
        }
        const xhr = new XMLHttpRequest();
        xhr.open("POST", URL + "/submit-art");

        xhr.setRequestHeader("Accept", "application/json");
        xhr.setRequestHeader("Content-Type", "application/json");

        xhr.onload = () => {
            if (xhr.status !== 200) {
                document.getElementById("error").innerText = JSON.parse(xhr.responseText).message;
                document.getElementById("submit-but").style.display = "inline-block";
            } else {
                const id = JSON.parse(xhr.responseText).id;
                console.log("Inserted line " + id + ". Preparing files...");

                SendFiles(id);
            }
        }

        let data = JSON.stringify(artSubmission);
        xhr.send(data);
    }

    function SendFiles(id) {
        var formData = new FormData();

        formData.append("exhibitionCover", document.getElementById("exhibition-cover").files[0]);
        formData.append("profilePic", document.getElementById("profile-pic").files[0]);
        formData.append("filesZip", document.getElementById("files").files[0])
        var xhr = new XMLHttpRequest();
        xhr.open("POST", URL + "/files/submit-art-files?target=" + id);
        xhr.onload = () => {
            if (xhr.status !== 200) {
                document.getElementById("error").innerText = JSON.parse(xhr.responseText).message;
                document.getElementById("submit-but").style.display = "inline-block";
            } else {
                console.log(xhr.responseText);
                const pages = document.getElementsByClassName("page");
                for (let el of pages) {
                    el.style.display = "none";
                }

                document.getElementById("success").style.display = "block";
            }
        }

        xhr.send(formData);
    }

    function loadZip(evt) {
        const file = evt.target.files[0];
        if (file.size > 25 * 1048576) {
            alert("File is too big!");
            evt.target.value = "";
            return;
        }
    }

    function loadGalleryCover(evt) {
        let targetImg = document.getElementById("cover-pic-image");
        uploadPicToTarget(evt, targetImg, 512, 512);
    }

    function uploadPicToTarget(evt, targetImg, maxW, maxH) {
        const file = evt.target.files[0];

        const reader = new FileReader();
        reader.onload = function () {
            var img = new Image();
            img.src = reader.result;
            targetImg.style.backgroundImage = "url(" + reader.result + ")";

            img.onload = function () {
                const h = this.height;
                const w = this.width;
                if (h > maxH || w > maxW) {
                    alert(`Height and Width must not exceed ${maxW}x${maxH}px.`);
                    evt.target.value = "";
                    targetImg.style.backgroundImage = "";
                    return false;
                }

                return true;
            }
        }

        if (file) {
            reader.readAsDataURL(file);
        }
    }

    function loadProfilePic(evt) {
        let targetImg = document.getElementById("profile-pic-image");
        uploadPicToTarget(evt, targetImg, 512, 512);
    }
</script>

</html>